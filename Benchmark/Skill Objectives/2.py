from inference_wrappers import DentalMind_o1_inference
import os
import sys
#设置GPU可见设备
os.environ["CUDA_VISIBLE_DEVICES"] = "1,2,3"
block={
        "病史": "一般资料：\n患者为38岁女性，因常规牙科治疗过程中出现不适就诊。\n主诉：\n患者在下颌第二磨牙牙冠预备及同侧上颌前磨牙银汞合金充填过程中感到胸闷、心悸，伴有焦虑。\n现病史：\n患者在接受下牙槽神经阻滞麻醉后立即出现症状，表现为胸闷、心悸和焦虑。注射药物为含1:80,000肾上腺素的2%利多卡因（1.0ml），注射完成后患者迅速感到不适。两天前曾接受类似局麻治疗（三针含1:80,000肾上腺素的2%利多卡因），无异常反应。\n既往史：\n患者自述健康状况良好，无过敏史，长期未进行牙科治疗，近期因恐惧心理首次接受多次简单修复治疗。\n临床检查：\n患者神志清醒，但紧张不安，逐渐平静后自述心跳减慢。\n脉搏：105次/分；血压：140/90mmHg。\n无明显面色苍白、皮疹或荨麻疹，呼吸稍困难，但吸氧后症状缓解。\n影像学检查：\n无相关影像学检查。",
        "问题": [
            "根据患者主诉、病史及检查情况，作出你的诊断，并简述诊断依据。",
            "该病例中可能需要进行哪些鉴别诊断？请列出至少两项鉴别诊断疾病，并说明如何鉴别。",
            "请提出你的治疗原则和具体治疗方案，包括紧急处理、长期修复方案及预防措施。"
        ],
        "答案": "No content found",
        "graph": [
            {
                "name": "局麻药血管内注射反应",
                "labels": [
                    "口腔疾病"
                ],
                "properties": {
                    "治疗方案": "{'紧急处理': ['让患者平卧，头部略低，保持通气良好。', '给予吸氧，安抚情绪，指导其缓慢深呼吸。', '监测脉搏与血压变化，若持续升高或加重，予以对症治疗。', '症状重者可使用β阻滞剂或镇静药（如地西泮），遵医嘱处理。'], '长期管理': ['未来治疗中优选不含肾上腺素的局麻药或减少浓度使用。', '注射前应使用回抽技术确认未入血管，缓慢推注。', '在操作前向患者说明局麻药副作用及应对策略，避免心理恐惧。']}",
                    "临床表现": "['注射后立即出现胸闷、心悸、焦虑等不适感。', '可伴轻度呼吸困难、面色潮红、手颤等交感神经兴奋症状。', '一般无皮疹、荨麻疹、气道水肿等过敏性表现。', '生命体征多为轻度升高，如脉搏增快、血压升高。']",
                    "鉴别诊断": "[{'疾病': '血管迷走神经性反应', '鉴别点': '常伴心动过缓、面色苍白、恶心、晕厥等症状；本病脉搏增快，症状缓解迅速。'}, {'疾病': '心肌梗死', '鉴别点': '典型表现为胸痛压榨感、放射痛、恶心等，本病多无相关表现且患者无心脏病史。'}, {'疾病': '局麻药过敏反应', '鉴别点': '表现为皮疹、荨麻疹、气促等过敏性症状，本病无典型过敏体征。'}, {'疾病': '局麻药中毒', '鉴别点': '需较大量药物或多次注射积累，本病例仅使用1ml药物，远低于毒性剂量。'}]",
                    "病因": "['局麻药注射过程中误入血管，尤其是血管分布丰富区域（如下颌孔区）。', '药物中含有肾上腺素等血管收缩剂，其迅速进入血液可导致交感神经兴奋。']",
                    "名称": "局麻药血管内注射反应",
                    "疾病定义": "局麻药血管内注射反应是指在牙科或其他小手术中局部麻醉药意外进入血管后引起的一组全身症状，常与局麻药中含有的血管收缩剂（如肾上腺素）相关，表现为心悸、胸闷、焦虑等。",
                    "治疗原则": "['立即停止操作，安抚患者，确保气道通畅。', '吸氧支持，监测生命体征，缓解交感兴奋状态。', '必要时进行药物干预并排除严重疾病（如心梗、过敏）。', '患者教育，避免误以为过敏，减少心理恐惧。']",
                    "诊断要点": "['症状出现时间与局麻药注射密切相关，通常为注射后数秒至数分钟。', '典型用药为含肾上腺素的局麻药（如2%利多卡因+1:80,000肾上腺素）。', '无典型过敏反应表现（如皮疹、哮喘）、无晕厥或心动过缓（排除迷走神经反应）。', '症状通常可在数分钟至十余分钟内缓解，吸氧和情绪安抚有效。']",
                    "预防与随访": "['严格掌握局麻药注射技巧，避免穿刺血管。', '术前充分评估患者紧张程度和基础健康状态。', '建议有此类反应史者建立“局麻药使用档案”，必要时心理干预。', '如症状持续或反复发作，推荐心内科评估排除心源性基础病。']",
                    "预后": "多数患者在短时间内缓解，无后遗症，属于可控的不良反应。若反应强烈或频繁，应进行专项管理。"
                }
            }
        ]
    }
history= block["病史"]
ques_pair = block["问题"]
graph= block["graph"]
prompt = (
    "请你用准确完整有逻辑的表达回答以下口腔医学问题:\n"
    f"该病人的病史为:\n{history}\n问题为:\n{ques_pair}\n\n可以参考的知识图谱为:\n{str(graph)}\n\n"
    "要求：输出三个题目答案，格式为：\n答案1. \n答案2. \n答案3.请严格按照格式输出"
)
response,graph=DentalMind_o1_inference(prompt)
print(response)
